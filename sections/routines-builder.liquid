{% comment %} if emitted {% endcomment %}
{{ 'routine-builder.css' | asset_url | stylesheet_tag }}
<script src="{{ 'routine-builder.js' | asset_url }}" defer></script>

<script type="application/json" id="routine-builder-props">
{
  "products": [
    { "id": "fancy-face", "title": "Fancy Face", "category": "Cleanse", "dayPart": "PM", "flags": ["fancy-face"], "variantId": 39649581105286 },

    
    { "id": "juicy-gel", "title": "Juicy Gel", "category": "Cleanse", "dayPart": "AM + PM", "flags": ["juicy-gel"], "variantId": 40217018007686 },
    { "id": "properly-clean", "title": "Properly Clean", "category": "Cleanse", "dayPart": "AM + PM", "flags": ["properly-clean"], "variantId": 40074850664582 },
    { "id": "glow-exfol", "title": "Glow Exfoliator", "category": "Exfoliate", "dayPart": "PM", "flags": ["exfoliator", "glow-exfol"], "variantId": 40162552021126 },
    { "id": "clarifying-exfol", "title": "Clarifying Exfoliator", "category": "Exfoliate", "dayPart": "PM", "flags": ["exfoliator", "clarifying-exfol"], "variantId": 40162551431302 },
    { "id": "gentle-exfol", "title": "Gentle Exfoliator", "category": "Exfoliate", "dayPart": "PM", "flags": ["exfoliator", "gentle-exfol"], "variantId": 40162550218886 },
    { "id": "retinal", "title": "Very Amazing Retinal", "category": "Treat", "dayPart": "PM", "flags": ["retinal"], "variantId": 40932269064326 },
    { "id": "much-brighter", "title": "Much Brighter Skin", "category": "Treat", "dayPart": "AM + PM", "flags": ["much-brighter"], "variantId": 39390250467462 },
    { "id": "much-plumper", "title": "Much Plumper Skin", "category": "Treat", "dayPart": "AM + PM", "flags": ["much-plumper"], "variantId": 39739527168134 },
    { "id": "de-crease", "title": "De-Crease", "category": "Treat", "dayPart": "PM", "flags": ["de-crease"], "variantId": 40471988895878 },
    { "id": "clarifying-face-hero", "title": "Clarifying Face Hero", "category": "Treat", "dayPart": "AM + PM", "flags": ["clarifying-face-hero"], "variantId": 41496309792902 },
    { "id": "face-hero", "title": "Face Hero", "category": "Nourish", "dayPart": "AM + PM", "flags": ["face-hero"], "variantId": 29223865057363 },
    { "id": "very-luxe", "title": "Very Luxe Face Cream", "category": "Nourish", "dayPart": "AM + PM", "flags": ["very-luxe"], "variantId": 40147086344326 },
    { "id": "very-useful", "title": "Very Useful Face Cream", "category": "Nourish", "dayPart": "AM + PM", "flags": ["very-useful"], "variantId": 39335968899206 },
    { "id": "very-lightweight", "title": "Very Lightweight Moisturiser", "category": "Nourish", "dayPart": "AM + PM", "flags": ["very-lightweight"], "variantId": 39834413138054 },
    { "id": "nifty-fifty-min", "title": "Nifty Fifty Mineral", "category": "Protect", "dayPart": "AM", "flags": ["spf"], "variantId": 41318816317574 }
  ],
  "descriptions": {
    "Exfoliate": {{ section.settings.desc_exfoliate | json }},
    "Cleanse": {{ section.settings.desc_cleanse | json }},
    "Treat": {{ section.settings.desc_treat | json }},
    "Nourish": {{ section.settings.desc_nourish | json }},
    "Protect": {{ section.settings.desc_protect | json }}
  },
  "imagesByTitle": {
    {%- for product in collections["routines-builder"].products -%}
      {%- assign first_img = product.images | first -%}
      {%- assign second_img = product.images | slice: 1, 1 | first -%}
      {{ product.title | json }}: [
        {%- if first_img -%}{{ first_img | img_url: '800x' | json }}{%- else -%}null{%- endif -%},
        {%- if second_img -%}{{ second_img | img_url: '800x' | json }}{%- else -%}null{%- endif -%}
      ]{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  }
}
</script>
<script>
  (function() {
    var el = document.getElementById('routine-builder-props');
    if (!el) return;
    try {
      var props = JSON.parse(el.textContent || '{}');
      if (props && Array.isArray(props.products) && props.imagesByTitle) {
        props.products.forEach(function(p) {
          var arr = props.imagesByTitle[p.title];
          if (arr) {
            if (!p.image && arr[0]) p.image = arr[0];
            if (!p.image_1 && arr[0]) p.image_1 = arr[0];
            if (!p.image_2 && arr[1]) p.image_2 = arr[1];
          }
        });
        el.textContent = JSON.stringify(props);
      }
    } catch (e) {
      // fail silently
    }
  })();
</script>

<div id="routine-builder-root"></div>


{% schema %}
{
  "name": "Routines Builder",
  "class": "shopify-section--rich-text",
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
    "type": "text",
    "id": "id",
    "label": "ID",
    "info": "Optional. Used with in-page navigation."
    },
    {
      "type": "header",
      "content": "Routine step descriptions"
    },
    {
      "type": "richtext",
      "id": "desc_exfoliate",
      "label": "Exfoliate description",
      "default": "<p>Exfoliation helps remove dead skin cells to smooth texture and improve the look of dullness. Use as directed and avoid over-exfoliating.</p>"
    },
    {
      "type": "richtext",
      "id": "desc_cleanse",
      "label": "Cleanse description",
      "default": "<p>To remove dirt, oil, makeup, and pollution from your skin, which can clog pores and reduce the effectiveness of the next products in your routine.</p>"
    },
    {
      "type": "richtext",
      "id": "desc_treat",
      "label": "Treat description",
      "default": "<p>Target specific skin goals (like brightness, clarity, or fine lines) with active ingredients layered after cleansing and before moisturiser.</p>"
    },
    {
      "type": "richtext",
      "id": "desc_nourish",
      "label": "Nourish description",
      "default": "<p>Lock in hydration and support the skin barrier with moisturisers and oils so skin feels comfortable and balanced.</p>"
    },
    {
      "type": "richtext",
      "id": "desc_protect",
      "label": "Protect description",
      "default": "<p>Shield skin from UV and environmental stressors each morning with SPF for healthier-looking skin over time.</p>"
    }
  ],
  "presets": [
    {
      "name": "Routines Builder",
      "settings": {}
    }
  ]
}
{% endschema %}